<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="../../styles/main.css" />
    <link rel="stylesheet" href="./BF.css" />
    <link rel="stylesheet" href="../../styles/web-projects.css" />
    <link
      rel="icon"
      href="https://avatars.githubusercontent.com/u/62946885?v=4"
    />
    <title>BrainF*ck</title>
  </head>

  <body>
    <div class="topnav" id="myTopnav">
      <a href="/">Home</a>
      <a href="/apps/index.html">Web Projects</a>
      <a href="https://github.com/Wyliemaster">Github</a>
      <a href="https://www.youtube.com/channel/UCG5I4-KAW3Kwzam4svLJWBA">YouTube</a>
      <a href="javascript:void(0);" class="icon" onclick="myFunction()">
        <i class="fa fa-bars"></i>
      </a>
    </div>

    <div class="BF_INPUT">
      <textarea id="BF_CODE" class="BF_CODE"></textarea>
      <button onclick="extract_code_from_text_area()" class="BF_BTN">
        Run Code
      </button>
      <button onclick="reset()" class="BF_BTN">Reset Cache</button>
    </div>

    <div class="BF_OUTPUT">
      <label>Output:</label>
      <label id="iBF_OUTPUT"></label>
    </div>

    <script>
      const TOKENS = {
        "+": increment,
        "-": decrement,
        "<": left_shift,
        ">": right_shift,
        ".": output,
        ",": input,
        "[": left_loop,
        "]": right_loop,
      };
      const MEMORY_SIZE = 30000;
      const DEBUG = true;

      var code_pos = 0;
      var safety_idx = 0;

      let memory = new Array(MEMORY_SIZE).fill(0);
      let pointer = 0;
      let stack = []; // position of the start of loops
      let string = "";
      let code = "";

      function extract_code_from_text_area() {
        code = document.getElementById("BF_CODE").value;
        exec_BF(code);

        var node = document.createTextNode(string.toString());
        document.getElementById("iBF_OUTPUT").appendChild(node);
      }

      function reset() {
        memory = new Array(MEMORY_SIZE).fill(0);
        pointer = 0;
        stack = []; // position of the start of loops
        code_pos = 0;
        safety_idx = 0;
        string = "";
        code = "";
        document.getElementById("iBF_OUTPUT").innerHTML = "";
      }

      function DEBUG_LOG(log) {
        console.log(`[LOG] ${log}`);
      }

      function increment() {
        memory[pointer]++;
      }

      function decrement() {
        memory[pointer]--;
      }

      function left_shift() {
        if (pointer > 0) pointer--;
      }

      function right_shift() {
        if (pointer < MEMORY_SIZE) pointer++;
      }

      function output() {
        string += String.fromCharCode(memory[pointer]);
      }

      function input() {
        let user_input = parseInt(window.prompt("Enter a Number"));
        if (isNaN(user_input)) return input();

        memory[pointer] = user_input;
      }

      function left_loop() {
        stack.push(code_pos);
      }

      function right_loop() {
        if (memory[pointer] == 0) {
          stack.pop();
          return;
        }

        if (stack.length == 0) return;

        code_pos = stack.at(-1);
      }

      function exec_BF(code) {
        const LEN = code.length;

        while (code_pos < LEN) {
          try {
            TOKENS[code[code_pos++]]();
          } catch {
            if (DEBUG)
              DEBUG_LOG(
                `Unknown TOKEN("${code[code_pos - 1]}") at position ${
                  code_pos - 1
                }`
              );
          }

          if (++safety_idx == 10000000) break;
        }

        if (DEBUG) DEBUG_LOG(`All Tokens have been executed`);

        return true;
      }
    </script>
  </body>
</html>
